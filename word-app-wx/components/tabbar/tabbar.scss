// ========== 变量（主题变量由 .theme-* 注入） ==========
$white: #fff;
$gray-700: #374151;
$black: #000;

$bar-radius: 48rpx;
$pill-radius: 24rpx;
$bar-padding-x: 24rpx;
$bar-padding-y: 16rpx;
$item-width: 120rpx;
$item-height: 88rpx;
$icon-size: 40rpx;
$icon-size-active: 48rpx;

$ease-out: cubic-bezier(0.25, 0.46, 0.45, 0.94);
$duration: 0.25s;

// 深色模式变量
$dark-bg: rgba(30, 30, 30, 0.72);
$dark-border: rgba(255, 255, 255, 0.1);
$dark-pill-bg: rgba(255, 255, 255, 0.12);
$dark-pill-border: rgba(255, 255, 255, 0.15);
$dark-label: rgba(255, 255, 255, 0.85);
$dark-label-muted: rgba(255, 255, 255, 0.5);
$badge-bg: #ff4d4f;
$badge-text: #fff;

// 覆盖层：绝对定位铺满 + 圆角
@mixin cover($radius: $bar-radius) {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  border-radius: $radius;
  pointer-events: none;
}

.tabbar {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 100;
  padding: 24rpx 24rpx 0;
  padding-bottom: calc(24rpx + constant(safe-area-inset-bottom));
  padding-bottom: calc(24rpx + env(safe-area-inset-bottom));
  box-sizing: border-box;
  display: flex;
  justify-content: center;
}

.tabbar__bar {
  border-radius: $bar-radius;
  background: var(--app-glass-bg, rgba($white, 0.42));
  backdrop-filter: var(--app-glass-blur, blur(120rpx) saturate(180%));
  -webkit-backdrop-filter: var(--app-glass-blur, blur(120rpx) saturate(180%));
  border: 1rpx solid var(--app-glass-border, rgba($white, 0.58));
  box-shadow:
    0 4rpx 24rpx rgba($black, 0.06),
    0 16rpx 48rpx rgba($black, 0.08),
    0 0 1rpx rgba($black, 0.04);
  position: relative;
  overflow: visible;
  transition: box-shadow $duration $ease-out, background $duration $ease-out, border-color $duration $ease-out;
}

.tabbar__bar-inner {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: $bar-padding-y $bar-padding-x;
}

.tabbar__bar-gradient {
  @include cover;
  background: linear-gradient(
    to bottom,
    rgba($white, 0.32),
    rgba($white, 0.12),
    rgba($white, 0.06)
  );
}

.tabbar__bar-dots {
  @include cover;
  opacity: 0.05;
  background-image: radial-gradient(
    circle at 2rpx 2rpx,
    rgba($white, 0.65) 0,
    transparent 4rpx
  );
  background-size: 12rpx 12rpx;
}

.tabbar__bar-shine {
  @include cover;
  box-shadow:
    inset 0 1rpx 0 rgba($white, 0.72),
    inset 0 -1rpx 0 rgba($black, 0.05);
}

.tabbar__bar-shadow {
  position: absolute;
  bottom: -8rpx;
  left: 32rpx;
  right: 32rpx;
  height: 24rpx;
  background: rgba($black, 0.04);
  border-radius: 50%;
  filter: blur(20rpx);
  pointer-events: none;
}

.tabbar__item {
  position: relative;
  width: $item-width;
  height: $item-height;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: transform $duration $ease-out, opacity $duration $ease-out;

  &--pressed {
    transform: scale(0.96);
    opacity: 0.9;
  }

  &--disabled {
    opacity: 0.5;
    pointer-events: none;
  }
}

.tabbar__item-pill {
  @include cover($pill-radius);
  background: rgba($white, 0.52);
  border: 1rpx solid rgba($white, 0.68);
  box-shadow:
    0 8rpx 24rpx rgba($black, 0.06),
    inset 0 1rpx 0 rgba($white, 0.5);
  transition: opacity $duration $ease-out, transform $duration $ease-out;
}

.tabbar__item-content {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.tabbar__item-icon-wrap {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tabbar__item-icon {
  width: $icon-size;
  height: $icon-size;
  transition: transform $duration $ease-out, opacity $duration $ease-out, width $duration $ease-out, height $duration $ease-out;

  &--active {
    width: $icon-size-active;
    height: $icon-size-active;
    transform: scale(1.06);
    opacity: 1;
  }

  &--inactive {
    opacity: 0.78;
  }
}

.tabbar__item-label {
  margin-top: 6rpx;
  max-height: 36rpx;
  font-size: 20rpx;
  font-weight: bold;
  letter-spacing: 0.04em;
  color: var(--app-text-secondary, $gray-700);
  line-height: 1;
  overflow: hidden;
  transition: opacity $duration $ease-out, transform $duration $ease-out, margin $duration $ease-out, max-height $duration $ease-out;

  &--hidden {
    opacity: 0;
    max-height: 0;
    margin-top: 0;
    transform: scale(0.96);
  }
}

// 角标：置于图标右上角，贴近图标边缘
.tabbar__badge {
  position: absolute;
  top: -12rpx;
  right: -16rpx;
  min-width: 24rpx;
  height: 22rpx;
  border-radius: 11rpx;
  background: $badge-bg;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 6rpx;
  box-sizing: border-box;
  white-space: nowrap;
  max-width: 52rpx;
  overflow: hidden;
  text-overflow: ellipsis;

  &--dot {
    min-width: 14rpx;
    width: 14rpx;
    height: 14rpx;
    border-radius: 50%;
    top: -8rpx;
    right: -8rpx;
    max-width: none;
  }

  &-text {
    font-size: 16rpx;
    font-weight: bold;
    color: $badge-text;
    line-height: 1;
    letter-spacing: -0.5rpx;
  }
}

// 深色模式（优先使用主题变量）
.tabbar--dark {
  .tabbar__bar {
    background: var(--app-glass-bg, $dark-bg);
    border-color: var(--app-glass-border, $dark-border);
    box-shadow:
      0 4rpx 24rpx rgba($black, 0.2),
      0 16rpx 48rpx rgba($black, 0.15),
      0 0 1rpx rgba($white, 0.08);
  }

  .tabbar__bar-gradient {
    background: linear-gradient(
      to bottom,
      rgba($white, 0.06),
      rgba($white, 0.02),
      transparent
    );
  }

  .tabbar__bar-dots {
    opacity: 0.04;
    background-image: radial-gradient(
      circle at 2rpx 2rpx,
      rgba($white, 0.25) 0,
      transparent 4rpx
    );
  }

  .tabbar__bar-shine {
    box-shadow:
      inset 0 1rpx 0 rgba($white, 0.08),
      inset 0 -1rpx 0 rgba($black, 0.2);
  }

  .tabbar__item-pill {
    background: $dark-pill-bg;
    border-color: $dark-pill-border;
    box-shadow:
      0 8rpx 24rpx rgba($black, 0.2),
      inset 0 1rpx 0 rgba($white, 0.06);
  }

  .tabbar__item-label {
    color: $dark-label-muted;
  }

  .tabbar__item-icon--inactive {
    opacity: 0.6;
  }
}
